# ---
# - hosts : all
#   remote_user : root
#   connection: local
#   become : yes
#   tasks:
#     - name: installing dnf
#       apt:
#         name: dnf
#         state: present
#     - name: install required packages
#       apt:
#         name: "{{item}}"
#         state: present
#       loop:
#       - httpd
#       - php
#       - php-mysqlnd
#       - php-gd
#       - php-xml
#       - mariadb-server
#       - mariadb
#       - php-mbstring
#       - php-json
#       - mod_ssl
#       - php-intl
#       - php-apcu
      
#     - name: Start and enable Apache (httpd) service
#       service:
#         name: httpd
#         state: started
#         enabled: yes

#     - name: Start and enable MariaDB (MySQL) service
#       service:
#         name: mariadb
#         state: started
#         enabled: yes

#     - name: Secure the MariaDB installation
#       command: mysql_secure_installation < /root/mysql_secure_installation_input.txt
#       args:
#         creates: /root/mysql_secure_installation_input.txt

#     - name: Download MediaWiki
#       get_url:
#         url: "https://releases.wikimedia.org/mediawiki/{{ mediawiki_version }}/mediawiki-{{ mediawiki_version }}.tar.gz"
#         dest: /tmp/mediawiki.tar.gz
#         mode: 0644
#       vars:
#         mediawiki_version: "1.37.1"  # Replace with the desired MediaWiki version

#     - name: Extract MediaWiki archive
#       unarchive:
#         src: /tmp/mediawiki.tar.gz
#         dest: /var/www/html/
#         remote_src: yes
#         owner: apache
#         group: apache
#         mode: 0755

#     - name: Create MediaWiki configuration directory
#       file:
#         path: /var/www/html/mediawiki/config
#         state: directory
#         owner: apache
#         group: apache
#         mode: 0755

#     - name: Clean up temporary files
#       file:
#         path: /tmp/mediawiki.tar.gz
#         state: absent

#     - name: Set SELinux to allow httpd to connect to the network (if SELinux is enabled)
#       selinux:
#         policy: targeted
#         state: permissive
#         type: httpd_t


  
- name: Set up local server
  hosts: all
  remote_user: root
  connection: local
  become_user: root
  become_method: sudo
  vars:
    app_path: "/var/www/snipeit"
    fqdn: "localhost"
  tasks:
    - name: Update and upgrade existing apt packages
      become: true
      apt:
        upgrade: yes
        update_cache: yes
    - name: Installing Apache httpd, PHP, MariaDB and other requirements.
      become: true
      apt:
        name: "{{ packages }}"
        state: present
      vars:
        packages:
          - httpd24-httpd
          - rh-php73
          - rh-php73-php
          - rh-php73-php-mbstring
          - rh-php73-php-mysqlnd
          - rh-php73-php-gd
          - rh-php73-php-xml
          - mariadb-server
          - mariadb 
          - curl
          - unzip
          
    # - name: Install MariaDB
    #   become: true
    #   apt:
    #     name: mariadb-server
    #     state: present
    #   register: sql_server
    # - name: Start and Enable MySQL server
    #   become: true 
    #   systemd:
    #     state: started
    #     enabled: yes
    #     name: mariadb
    # - name: Create snipeit database
    #   become: true
    #   mysql_db:
    #     name: snipeit
    #     state: present
    #     login_unix_socket: /var/run/mysqld/mysqld.sock
